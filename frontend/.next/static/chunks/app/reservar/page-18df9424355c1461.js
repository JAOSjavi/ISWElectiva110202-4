(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[501],{1286:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>m});var a=t(5155),r=t(2115),i=t(5695),l=t(9911),n=t(6874),o=t.n(n),c=t(9159),d=t(7471);t(6769);var h=t(5641),x=t(6766);function m(){var e;let[s,t]=(0,r.useState)([]),[n,m]=(0,r.useState)(!1),[p,f]=(0,r.useState)(null),[u,b]=(0,r.useState)(!0),[g,j]=(0,r.useState)(!1),[v,N]=(0,r.useState)(null),[w,k]=(0,r.useState)([new Date,new Date(Date.now()+6048e5)]),[C,S]=(0,r.useState)(!1),[y,D]=(0,r.useState)(!0),B=(0,i.useRouter)(),{addNotification:E}=(0,h.h)();(0,r.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("token");if(!e)return void B.push("/login");let s=(0,c.s)(e),t=Date.now()/1e3;if(s.exp&&s.exp<t){localStorage.removeItem("token"),localStorage.removeItem("refresh_token"),B.push("/login");return}await _(e,!1)}catch(e){console.error("Error:",e),N("Error al cargar las habitaciones")}finally{b(!1)}})()},[B]);let _=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{j(!0);let a=e||localStorage.getItem("token");if(!a)return void B.push("/login");let r="".concat("http://localhost:8000","/api/habitaciones/disponibles/");if(s&&w[0]&&w[1]){let e=w[0].toISOString().split("T")[0],s=w[1].toISOString().split("T")[0];r+="?fecha_inicio=".concat(e,"&fecha_fin=").concat(s)}let i=await fetch(r,{headers:{Authorization:"Bearer ".concat(a)}});if(!i.ok)throw Error("Error al obtener las habitaciones");let l=await i.json();t(l),N(null)}catch(e){console.error("Error:",e),N("Error al cargar las habitaciones disponibles")}finally{j(!1)}};(0,r.useEffect)(()=>{w[0]&&w[1]&&!u&&_(null,!0)},[w]),(0,r.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("token");if(!e)return void D(!1);let s=await fetch("".concat("http://localhost:8000","/api/reservas/"),{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!s.ok)return void D(!1);let t=await s.json(),a=t.filter(e=>"pagada"===e.estado),r=t.filter(e=>"checkin_aceptado"===e.estado);S(0===a.length&&r.length>0)}catch(e){S(!1)}finally{D(!1)}})()},[B]);let F=async e=>{f(s.find(s=>s.id===e)),m(!0)},I=async()=>{try{let e=localStorage.getItem("token");if(!e)return void B.push("/login");let a=await fetch("".concat("http://localhost:8000","/api/reservas/"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({habitacion_id:p.id,fecha_inicio:w[0].toISOString().split("T")[0],fecha_fin:w[1].toISOString().split("T")[0],estado:"pendiente"})});if(!a.ok){let e=a.headers.get("content-type"),s="Error al crear la reserva";if(e&&e.includes("application/json")){let e=await a.json();s=JSON.stringify(e)||s}else s="Error en el servidor o endpoint no encontrado";throw Error(s)}let r=await a.json();localStorage.setItem("ultima_reserva",JSON.stringify({id:r.id,habitacion:p.numero_habitacion,tipo:p.tipo_habitacion,fecha_inicio:w[0].toISOString().split("T")[0],fecha_fin:w[1].toISOString().split("T")[0],noches:z(),precio_noche:p.precio,total:T(),estado:"pendiente"}));let i=s.filter(e=>e.id!==p.id);t(i),await _(null,!0),m(!1),E("Reserva creada, procede al pago","success"),B.push("/pagos")}catch(e){console.error("Error:",e),alert(e.message||"Error al crear la reserva. Por favor, intente nuevamente.")}},z=()=>w[0]&&w[1]?Math.ceil(Math.abs(w[1]-w[0])/864e5):0,T=()=>p?(p.precio*z()).toFixed(2):0;return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-[#FFF3E0] to-[#FFE4C4]",children:[(0,a.jsxs)("div",{className:"fixed left-0 top-0 h-full w-64 bg-gradient-to-b from-[#8B4513] to-[#A0522D] p-6 flex flex-col shadow-xl",children:[(0,a.jsxs)("div",{className:"flex-1 space-y-4",children:[(0,a.jsxs)(o(),{href:"/home",className:"flex items-center space-x-3 p-4 bg-[#CD853F]/20 backdrop-blur-sm text-white rounded-xl hover:bg-[#CD853F]/40 transition-all duration-300 transform hover:scale-105",children:[(0,a.jsx)(l.rQ8,{size:24}),(0,a.jsx)("span",{className:"text-lg font-semibold",children:"Home"})]}),(0,a.jsxs)(o(),{href:"/reservar",className:"flex items-center space-x-3 p-4 bg-[#CD853F]/40 backdrop-blur-sm text-white rounded-xl hover:bg-[#CD853F]/60 transition-all duration-300 transform hover:scale-105",children:[(0,a.jsx)(l.TiC,{size:24}),(0,a.jsx)("span",{className:"text-lg font-semibold",children:"Reservar"})]}),(0,a.jsxs)(o(),{href:"/check-in",className:"flex items-center space-x-3 p-4 bg-[#CD853F]/20 backdrop-blur-sm text-white rounded-xl hover:bg-[#CD853F]/40 transition-all duration-300 transform hover:scale-105",children:[(0,a.jsx)(l.vq8,{size:24}),(0,a.jsx)("span",{className:"text-lg font-semibold",children:"Check-In"})]}),(0,a.jsxs)(o(),{href:"/check-out",className:"flex items-center space-x-3 p-4 bg-[#CD853F]/20 backdrop-blur-sm text-white rounded-xl hover:bg-[#CD853F]/40 transition-all duration-300 transform hover:scale-105",children:[(0,a.jsx)(l.axc,{size:24}),(0,a.jsx)("span",{className:"text-lg font-semibold",children:"Check-Out"})]}),(0,a.jsxs)(o(),{href:"/pagos",className:"flex items-center space-x-3 p-4 bg-[#CD853F]/20 backdrop-blur-sm text-white rounded-xl hover:bg-[#CD853F]/40 transition-all duration-300 transform hover:scale-105",children:[(0,a.jsx)(l.XVP,{size:24}),(0,a.jsx)("span",{className:"text-lg font-semibold",children:"Pagos"})]}),(0,a.jsxs)(o(),{href:"/notificaciones",className:"flex items-center space-x-3 p-4 bg-[#CD853F]/20 backdrop-blur-sm text-white rounded-xl hover:bg-[#CD853F]/40 transition-all duration-300 transform hover:scale-105",children:[(0,a.jsx)(l.jNV,{size:24}),(0,a.jsx)("span",{className:"text-lg font-semibold",children:"Notificaciones"})]}),(0,a.jsxs)(o(),{href:"/configuraciones",className:"flex items-center space-x-3 p-4 bg-[#CD853F]/20 backdrop-blur-sm text-white rounded-xl hover:bg-[#CD853F]/40 transition-all duration-300 transform hover:scale-105",children:[(0,a.jsx)(l.Pcn,{size:24}),(0,a.jsx)("span",{className:"text-lg font-semibold",children:"Configuraciones"})]})]}),(0,a.jsxs)("button",{onClick:()=>{localStorage.removeItem("token"),localStorage.removeItem("refresh_token"),B.push("/login")},className:"flex items-center space-x-3 p-4 mt-4 bg-[#A0522D]/80 text-white rounded-xl hover:bg-[#8B4513] transition-all duration-300 transform hover:scale-105 shadow-lg",children:[(0,a.jsx)(l.e9S,{size:24}),(0,a.jsx)("span",{className:"text-lg font-semibold",children:"Cerrar Sesi\xf3n"})]})]}),(0,a.jsxs)("div",{className:"ml-64 p-8",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold text-[#8B4513] mb-8",children:"Habitaciones Disponibles"}),y?(0,a.jsx)("div",{className:"text-center py-8 text-[#8B4513]",children:"Verificando reservas activas..."}):C?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl p-12 mt-12",children:[(0,a.jsx)(l.JhU,{size:64,className:"text-[#8B4513] mb-6"}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-[#8B4513] mb-4",children:"No puedes reservar hasta finalizar tu(s) estancia(s)"}),(0,a.jsx)("p",{className:"text-[#A0522D] text-lg",children:"Debes hacer checkout de todas tus reservas activas antes de poder reservar otra habitaci\xf3n."})]}):u?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#8B4513] mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-[#8B4513]",children:"Cargando habitaciones..."})]}):v?(0,a.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:[(0,a.jsx)("strong",{className:"font-bold",children:"Error: "}),(0,a.jsx)("span",{className:"block sm:inline",children:v})]}):(0,a.jsxs)("div",{children:[g&&(0,a.jsx)("div",{className:"text-center py-4 mb-6",children:(0,a.jsxs)("div",{className:"inline-flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-[#8B4513]"}),(0,a.jsx)("span",{className:"text-[#8B4513]",children:"Actualizando habitaciones disponibles..."})]})}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(e=>{var s;return(0,a.jsxs)("div",{className:"bg-white/90 backdrop-blur-sm p-6 rounded-2xl shadow-xl transform hover:scale-[1.02] transition-all duration-300",children:[(0,a.jsx)("div",{className:"w-full h-48 relative mb-4 rounded-xl overflow-hidden",children:e.imagen?(0,a.jsx)(x.default,{src:(null==(s=e.imagen)?void 0:s.startsWith("http"))?e.imagen:"".concat("http://localhost:8000","/media/imagenes/habitaciones/").concat(e.imagen),alt:"Habitaci\xf3n ".concat(e.numero_habitacion),fill:!0,className:"object-cover"}):(0,a.jsx)("div",{className:"w-full h-full bg-[#F5E1C0] flex items-center justify-center",children:(0,a.jsx)(l.TiC,{size:48,className:"text-[#8B4513]"})})}),(0,a.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-[#8B4513]",children:["Habitaci\xf3n ",e.numero_habitacion]}),(0,a.jsx)("span",{className:"bg-green-100 text-green-800 text-sm font-semibold px-3 py-1 rounded-full",children:"Disponible"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("p",{className:"text-[#8B4513]",children:[(0,a.jsx)("span",{className:"font-semibold",children:"Tipo:"})," ",e.tipo_habitacion]}),(0,a.jsxs)("p",{className:"text-[#8B4513]",children:[(0,a.jsx)("span",{className:"font-semibold",children:"Precio por noche:"})," $",e.precio]}),e.descripcion&&(0,a.jsxs)("p",{className:"text-[#8B4513]",children:[(0,a.jsx)("span",{className:"font-semibold",children:"Descripci\xf3n:"})," ",e.descripcion]}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsxs)("button",{onClick:()=>F(e.id),className:"w-full bg-[#8B4513] text-white py-3 rounded-xl hover:bg-[#A0522D] transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center justify-center space-x-2",children:[(0,a.jsx)(l.TiC,{size:20}),(0,a.jsx)("span",{children:"Reservar Ahora"})]})})]})]},e.id)})})]})]}),(0,a.jsxs)("div",{className:"fixed top-6 right-6 flex space-x-4",children:[(0,a.jsx)("button",{className:"p-3 bg-white/90 backdrop-blur-sm rounded-full shadow-lg hover:bg-white transition-all duration-300 transform hover:scale-110",children:(0,a.jsx)(l.jNV,{size:24,className:"text-[#8B4513]"})}),(0,a.jsx)("button",{className:"p-3 bg-white/90 backdrop-blur-sm rounded-full shadow-lg hover:bg-white transition-all duration-300 transform hover:scale-110",children:(0,a.jsx)(l.Pcn,{size:24,className:"text-[#8B4513]"})})]}),n&&p&&(0,a.jsx)("div",{className:"fixed inset-0 backdrop-blur-sm bg-black/30 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white/95 backdrop-blur-md rounded-2xl p-8 max-w-2xl w-full mx-4 shadow-2xl",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-[#8B4513] mb-6",children:"Confirmar Reserva"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-[#8B4513] mb-4",children:"Detalles de la Habitaci\xf3n"}),(0,a.jsx)("div",{className:"w-full h-48 relative mb-4 rounded-xl overflow-hidden",children:p.imagen?(0,a.jsx)(x.default,{src:(null==(e=p.imagen)?void 0:e.startsWith("http"))?p.imagen:"".concat("http://localhost:8000","/media/imagenes/habitaciones/").concat(p.imagen),alt:"Habitaci\xf3n ".concat(p.numero_habitacion),fill:!0,className:"object-cover"}):(0,a.jsx)("div",{className:"w-full h-full bg-[#F5E1C0] flex items-center justify-center",children:(0,a.jsx)(l.TiC,{size:48,className:"text-[#8B4513]"})})}),(0,a.jsxs)("p",{className:"text-[#8B4513]",children:[(0,a.jsx)("span",{className:"font-semibold",children:"Habitaci\xf3n:"})," ",p.numero_habitacion]}),(0,a.jsxs)("p",{className:"text-[#8B4513]",children:[(0,a.jsx)("span",{className:"font-semibold",children:"Tipo:"})," ",p.tipo_habitacion]}),(0,a.jsxs)("p",{className:"text-[#8B4513]",children:[(0,a.jsx)("span",{className:"font-semibold",children:"Precio por noche:"})," $",p.precio]}),p.descripcion&&(0,a.jsxs)("p",{className:"text-[#8B4513]",children:[(0,a.jsx)("span",{className:"font-semibold",children:"Descripci\xf3n:"})," ",p.descripcion]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-[#8B4513] mb-4",children:"Selecciona tus fechas"}),(0,a.jsx)("div",{className:"calendar-container",children:(0,a.jsx)(d.Ay,{onChange:k,value:w,selectRange:!0,minDate:new Date,className:"w-full border-none rounded-xl shadow-inner",tileClassName:"text-[#8B4513] hover:bg-[#CD853F]/20 transition-colors duration-200"})}),(0,a.jsxs)("div",{className:"mt-4 p-4 bg-[#FFF3E0] rounded-xl",children:[(0,a.jsxs)("p",{className:"text-[#8B4513]",children:[(0,a.jsx)("span",{className:"font-semibold",children:"Noches seleccionadas:"})," ",z()]}),(0,a.jsxs)("p",{className:"text-[#8B4513]",children:[(0,a.jsx)("span",{className:"font-semibold",children:"Total estimado:"})," $",T()]})]})]})]}),(0,a.jsxs)("div",{className:"mt-8 flex justify-end space-x-4",children:[(0,a.jsx)("button",{onClick:()=>m(!1),className:"px-6 py-3 text-[#8B4513] hover:text-[#A0522D] transition-colors font-semibold",children:"Cancelar"}),(0,a.jsxs)("button",{onClick:I,className:"px-6 py-3 bg-[#8B4513] text-white rounded-xl hover:bg-[#A0522D] transition-all duration-300 transform hover:scale-105 font-semibold flex items-center space-x-2",children:[(0,a.jsx)(l.bfZ,{size:20}),(0,a.jsx)("span",{children:"Confirmar Reserva"})]})]})]})})]})}},2145:(e,s,t)=>{Promise.resolve().then(t.bind(t,1286))},5641:(e,s,t)=>{"use strict";t.d(s,{h:()=>o,p:()=>n});var a=t(5155),r=t(2115);let i=(0,r.createContext)(),l="hotel_notifications";function n(e){let{children:s}=e,[t,n]=(0,r.useState)([]),[o,c]=(0,r.useState)([]);(0,r.useEffect)(()=>{let e=localStorage.getItem(l);e&&n(JSON.parse(e))},[]),(0,r.useEffect)(()=>{localStorage.setItem(l,JSON.stringify(t))},[t]);let d=(0,r.useCallback)(function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",t={id:Date.now()+Math.random(),message:e,type:s,date:new Date().toISOString(),read:!1};n(e=>[t,...e]),c(e=>[t,...e]),setTimeout(()=>{c(e=>e.filter(e=>e.id!==t.id))},3e3)},[]),h=(0,r.useCallback)(()=>{n(e=>e.map(e=>({...e,read:!0})))},[]),x=t.filter(e=>!e.read).length,m=(0,r.useCallback)(e=>{n(s=>s.filter(s=>s.id!==e))},[]),p=(0,r.useCallback)(()=>{n([])},[]);return(0,a.jsx)(i.Provider,{value:{notifications:t,addNotification:d,removeNotification:m,clearNotifications:p,toasts:o,markAllAsRead:h,unreadCount:x},children:s})}function o(){return(0,r.useContext)(i)}},9159:(e,s,t)=>{"use strict";t.d(s,{s:()=>r});class a extends Error{}function r(e,s){let t;if("string"!=typeof e)throw new a("Invalid token specified: must be a string");s||(s={});let r=+(!0!==s.header),i=e.split(".")[r];if("string"!=typeof i)throw new a(`Invalid token specified: missing part #${r+1}`);try{t=function(e){let s=e.replace(/-/g,"+").replace(/_/g,"/");switch(s.length%4){case 0:break;case 2:s+="==";break;case 3:s+="=";break;default:throw Error("base64 string is not of the correct length")}try{var t;return t=s,decodeURIComponent(atob(t).replace(/(.)/g,(e,s)=>{let t=s.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t}))}catch(e){return atob(s)}}(i)}catch(e){throw new a(`Invalid token specified: invalid base64 for part #${r+1} (${e.message})`)}try{return JSON.parse(t)}catch(e){throw new a(`Invalid token specified: invalid json for part #${r+1} (${e.message})`)}}a.prototype.name="InvalidTokenError"}},e=>{var s=s=>e(e.s=s);e.O(0,[0,711,244,766,810,441,684,358],()=>s(2145)),_N_E=e.O()}]);