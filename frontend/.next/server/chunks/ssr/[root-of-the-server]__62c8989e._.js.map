{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 31, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/Javier/Desktop/ISWElectiva110202-4/frontend/app/check-out/page.jsx"],"sourcesContent":["'use client'\r\nimport { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { FaHome, FaMapMarkerAlt, FaSignOutAlt, FaMoneyBill, FaBell, FaCog, FaPowerOff, FaBed, FaUser, FaIdCard, FaCar, FaReceipt } from 'react-icons/fa';\r\nimport Link from 'next/link';\r\nimport Image from 'next/image';\r\nimport { jwtDecode } from \"jwt-decode\";\r\nimport { useNotification } from '../../components/NotificationContext';\r\n\r\nexport default function CheckOut() {\r\n  const [estancias, setEstancias] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const router = useRouter();\r\n  const { addNotification } = useNotification();\r\n\r\n  useEffect(() => {\r\n    const checkAuth = async () => {\r\n      try {\r\n        const token = localStorage.getItem('token');\r\n        if (!token) {\r\n          router.push('/login');\r\n          return;\r\n        }\r\n\r\n        const decoded = jwtDecode(token);\r\n        const currentTime = Date.now() / 1000;\r\n        if (decoded.exp && decoded.exp < currentTime) {\r\n          localStorage.removeItem('token');\r\n          localStorage.removeItem('refresh_token');\r\n          router.push('/login');\r\n          return;\r\n        }\r\n\r\n        // Obtener reservas con check-in aceptado del usuario\r\n        const response = await fetch(`${process.env.NEXT_PUBLIC_API_BASE_URL}/api/reservas/`, {\r\n          headers: {\r\n            'Authorization': `Bearer ${token}`,\r\n            'Content-Type': 'application/json',\r\n          },\r\n        });\r\n        if (!response.ok) {\r\n          throw new Error('Error al obtener las reservas');\r\n        }\r\n        const data = await response.json();\r\n        // Filtrar solo reservas con check-in aceptado\r\n        const checkinAceptado = data.filter(r => r.estado === 'checkin_aceptado');\r\n        setEstancias(checkinAceptado);\r\n      } catch (error) {\r\n        console.error('Error:', error);\r\n        setError('Error al cargar las estancias');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    checkAuth();\r\n  }, [router]);\r\n\r\n  const handleLogout = () => {\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('refresh_token');\r\n    router.push('/login');\r\n  };\r\n\r\n  const handleCheckOut = async (estanciaId) => {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      if (!token) {\r\n        router.push('/login');\r\n        return;\r\n      }\r\n      const response = await fetch(`${process.env.NEXT_PUBLIC_API_BASE_URL}/api/reservas/${estanciaId}/`, {\r\n        method: 'PATCH',\r\n        headers: {\r\n          'Authorization': `Bearer ${token}`,\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({ estado: 'checkout' }),\r\n      });\r\n      if (!response.ok) {\r\n        throw new Error('Error al realizar el check-out');\r\n      }\r\n      addNotification('Check-Out realizado', 'success');\r\n      // Actualizar la lista de estancias\r\n      setEstancias(estancias.filter(estancia => estancia.id !== estanciaId));\r\n    } catch (error) {\r\n      console.error('Error:', error);\r\n      alert('Error al realizar el check-out');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-[#FFF3E0] to-[#FFE4C4]\">\r\n      {/* Left Sidebar */}\r\n      <div className=\"fixed left-0 top-0 h-full w-64 bg-gradient-to-b from-[#8B4513] to-[#A0522D] p-6 flex flex-col shadow-xl\">\r\n        {/* Menu Items */}\r\n        <div className=\"flex-1 space-y-4\">\r\n          <Link href=\"/home\" className=\"flex items-center space-x-3 p-4 bg-[#CD853F]/20 backdrop-blur-sm text-white rounded-xl hover:bg-[#CD853F]/40 transition-all duration-300 transform hover:scale-105\">\r\n            <FaHome size={24} />\r\n            <span className=\"text-lg font-semibold\">Home</span>\r\n          </Link>\r\n          \r\n          <Link href=\"/reservar\" className=\"flex items-center space-x-3 p-4 bg-[#CD853F]/20 backdrop-blur-sm text-white rounded-xl hover:bg-[#CD853F]/40 transition-all duration-300 transform hover:scale-105\">\r\n            <FaBed size={24} />\r\n            <span className=\"text-lg font-semibold\">Reservar</span>\r\n          </Link>\r\n          \r\n          <Link href=\"/check-in\" className=\"flex items-center space-x-3 p-4 bg-[#CD853F]/20 backdrop-blur-sm text-white rounded-xl hover:bg-[#CD853F]/40 transition-all duration-300 transform hover:scale-105\">\r\n            <FaMapMarkerAlt size={24} />\r\n            <span className=\"text-lg font-semibold\">Check-In</span>\r\n          </Link>\r\n          \r\n          <Link href=\"/check-out\" className=\"flex items-center space-x-3 p-4 bg-[#CD853F]/40 backdrop-blur-sm text-white rounded-xl hover:bg-[#CD853F]/60 transition-all duration-300 transform hover:scale-105\">\r\n            <FaSignOutAlt size={24} />\r\n            <span className=\"text-lg font-semibold\">Check-Out</span>\r\n          </Link>\r\n          \r\n          <Link href=\"/pagos\" className=\"flex items-center space-x-3 p-4 bg-[#CD853F]/20 backdrop-blur-sm text-white rounded-xl hover:bg-[#CD853F]/40 transition-all duration-300 transform hover:scale-105\">\r\n            <FaMoneyBill size={24} />\r\n            <span className=\"text-lg font-semibold\">Pagos</span>\r\n          </Link>\r\n          \r\n          <Link href=\"/notificaciones\" className=\"flex items-center space-x-3 p-4 bg-[#CD853F]/20 backdrop-blur-sm text-white rounded-xl hover:bg-[#CD853F]/40 transition-all duration-300 transform hover:scale-105\">\r\n            <FaBell size={24} />\r\n            <span className=\"text-lg font-semibold\">Notificaciones</span>\r\n          </Link>\r\n          \r\n          <Link href=\"/configuraciones\" className=\"flex items-center space-x-3 p-4 bg-[#CD853F]/20 backdrop-blur-sm text-white rounded-xl hover:bg-[#CD853F]/40 transition-all duration-300 transform hover:scale-105\">\r\n            <FaCog size={24} />\r\n            <span className=\"text-lg font-semibold\">Configuraciones</span>\r\n          </Link>\r\n        </div>\r\n\r\n        {/* Logout Button */}\r\n        <button \r\n          onClick={handleLogout}\r\n          className=\"flex items-center space-x-3 p-4 mt-4 bg-[#A0522D]/80 text-white rounded-xl hover:bg-[#8B4513] transition-all duration-300 transform hover:scale-105 shadow-lg\"\r\n        >\r\n          <FaPowerOff size={24} />\r\n          <span className=\"text-lg font-semibold\">Cerrar Sesi贸n</span>\r\n        </button>\r\n      </div>\r\n\r\n      {/* Main Content */}\r\n      <div className=\"ml-64 p-8\">\r\n        <h1 className=\"text-4xl font-bold text-[#8B4513] mb-8\">Check-Out</h1>\r\n\r\n        {loading ? (\r\n          <div className=\"text-center py-8\">\r\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-[#8B4513] mx-auto\"></div>\r\n            <p className=\"mt-4 text-[#8B4513]\">Cargando estancias...</p>\r\n          </div>\r\n        ) : error ? (\r\n          <div className=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative\" role=\"alert\">\r\n            <strong className=\"font-bold\">Error: </strong>\r\n            <span className=\"block sm:inline\">{error}</span>\r\n          </div>\r\n        ) : (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n            {estancias.map((estancia) => (\r\n              <div key={estancia.id} className=\"bg-white/90 backdrop-blur-sm p-6 rounded-2xl shadow-xl transform hover:scale-[1.02] transition-all duration-300\">\r\n                {/* Imagen de la habitaci贸n */}\r\n                <div className=\"w-full h-48 relative mb-4 rounded-xl overflow-hidden\">\r\n                  {estancia.habitacion.imagen ? (\r\n                    <Image\r\n                      src={\r\n                        estancia.habitacion.imagen?.startsWith('http')\r\n                          ? estancia.habitacion.imagen\r\n                          : `${process.env.NEXT_PUBLIC_API_BASE_URL}/media/imagenes/habitaciones/${estancia.habitacion.imagen}`\r\n                      }\r\n                      alt={`Habitaci贸n ${estancia.habitacion.numero_habitacion}`}\r\n                      fill\r\n                      className=\"object-cover\"\r\n                    />\r\n                  ) : (\r\n                    <div className=\"w-full h-full bg-[#F5E1C0] flex items-center justify-center\">\r\n                      <FaBed size={48} className=\"text-[#8B4513]\" />\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                <div className=\"flex justify-between items-start mb-4\">\r\n                  <h2 className=\"text-2xl font-bold text-[#8B4513]\">Habitaci贸n {estancia.habitacion.numero_habitacion}</h2>\r\n                  <span className=\"bg-blue-100 text-blue-800 text-sm font-semibold px-3 py-1 rounded-full\">\r\n                    Activa\r\n                  </span>\r\n                </div>\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"flex items-center space-x-2 text-[#8B4513]\">\r\n                    <FaBed className=\"text-[#8B4513]\" />\r\n                    <span className=\"font-semibold\">Tipo:</span>\r\n                    <span>{estancia.habitacion.tipo_habitacion}</span>\r\n                  </div>\r\n                  <div className=\"flex items-center space-x-2 text-[#8B4513]\">\r\n                    <FaUser className=\"text-[#8B4513]\" />\r\n                    <span className=\"font-semibold\">Fecha de entrada:</span>\r\n                    <span>{estancia.fecha_inicio}</span>\r\n                  </div>\r\n                  <div className=\"flex items-center space-x-2 text-[#8B4513]\">\r\n                    <FaCar className=\"text-[#8B4513]\" />\r\n                    <span className=\"font-semibold\">Fecha de salida:</span>\r\n                    <span>{estancia.fecha_fin}</span>\r\n                  </div>\r\n                </div>\r\n                <button\r\n                  onClick={() => handleCheckOut(estancia.id)}\r\n                  className=\"w-full mt-6 bg-[#8B4513] text-white py-3 px-4 rounded-xl hover:bg-[#A0522D] transition-all duration-300 transform hover:scale-105\"\r\n                >\r\n                  Realizar Check-Out\r\n                </button>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Top Right Icons */}\r\n      <div className=\"fixed top-6 right-6 flex space-x-4\">\r\n        <button className=\"p-3 bg-white/90 backdrop-blur-sm rounded-full shadow-lg hover:bg-white transition-all duration-300 transform hover:scale-110\">\r\n          <FaBell size={24} className=\"text-[#8B4513]\" />\r\n        </button>\r\n        <button className=\"p-3 bg-white/90 backdrop-blur-sm rounded-full shadow-lg hover:bg-white transition-all duration-300 transform hover:scale-110\">\r\n          <FaCog size={24} className=\"text-[#8B4513]\" />\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n} "],"names":[],"mappings":"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","debugId":null}}]
}